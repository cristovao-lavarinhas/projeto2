<!DOCTYPE html>
<html lang="pt" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Dashboard – DriveSmart</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/app.css" rel="stylesheet">
</head>
<body class="d-flex flex-column min-vh-100">

<header class="topbar">
    <div class="d-flex justify-content-between align-items-center">
        <a href="/" class="logo-text">DriveSmart</a>
        <div class="d-flex align-items-center gap-3">
            <span class="text-white">Olá, <span class="user-name">Utilizador</span>!</span>
            <span class="badge bg-light text-dark user-type">TIPO</span>
            <button id="logoutBtn" class="btn btn-outline-light btn-sm">Sair</button>
        </div>
    </div>
</header>

<main class="flex-grow-1 p-4">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">Dashboard</h1>
                
                <!-- Conteúdo específico por tipo de utilizador -->
                <div data-role="ADMIN" class="card mb-4">
                    <div class="card-header">
                        <h5>Painel de Administração</h5>
                    </div>
                    <div class="card-body">
                        <p>Bem-vindo ao painel de administração!</p>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card bg-primary text-white">
                                    <div class="card-body">
                                        <h6>Motoristas Pendentes</h6>
                                        <h3 id="motoristasPendentes">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <h6>Total de Clientes</h6>
                                        <h3 id="totalClientes">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-info text-white">
                                    <div class="card-body">
                                        <h6>Viagens Hoje</h6>
                                        <h3 id="viagensHoje">0</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div data-role="MOTORISTA" class="card mb-4">
                    <div class="card-header">
                        <h5>Painel do Motorista</h5>
                    </div>
                    <div class="card-body">
                        <p>Bem-vindo ao painel do motorista!</p>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card bg-warning text-dark">
                                    <div class="card-body">
                                        <h6>Viagens Pendentes</h6>
                                        <h3 id="viagensPendentes">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <h6>Viagens Concluídas</h6>
                                        <h3 id="viagensConcluidas">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-info text-white">
                                    <div class="card-body">
                                        <h6>Avaliação Média</h6>
                                        <h3 id="avaliacaoMedia">0.0</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div data-role="CLIENTE" class="card mb-4">
                    <div class="card-header">
                        <h5>Painel do Cliente</h5>
                    </div>
                    <div class="card-body">
                        <p>Bem-vindo ao painel do cliente!</p>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card bg-primary text-white">
                                    <div class="card-body">
                                        <h6>Viagens Realizadas</h6>
                                        <h3 id="viagensRealizadas">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-success text-white">
                                    <div class="card-body">
                                        <h6>Viagens Agendadas</h6>
                                        <h3 id="viagensAgendadas">0</h3>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-warning text-dark">
                                    <div class="card-body">
                                        <h6>Saldo Disponível</h6>
                                        <h3 id="saldoDisponivel">€0.00</h3>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button class="btn btn-drive" onclick="solicitarViagem()">
                                Solicitar Viagem
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Conteúdo comum a todos os tipos -->
                <div data-role="all" class="card">
                    <div class="card-header">
                        <h5>Informações Gerais</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Dados do Utilizador</h6>
                                <ul class="list-unstyled">
                                    <li><strong>Nome:</strong> <span class="user-name">-</span></li>
                                    <li><strong>Tipo:</strong> <span class="user-type">-</span></li>
                                    <li><strong>Email:</strong> <span id="userEmail">-</span></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Ações Rápidas</h6>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-outline-primary" onclick="verPerfil()">
                                        Ver Perfil
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="alterarPassword()">
                                        Alterar Password
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script src="/js/api-client.js"></script>
<script src="/js/auth-middleware.js"></script>
<script>
// Inicializar middleware para verificar autenticação
initAuthMiddleware({ requireAuth: true });

document.addEventListener('DOMContentLoaded', function() {
    // Carregar dados do utilizador
    loadUserData();
    
    // Carregar dados específicos baseado no tipo
    loadDashboardData();
    
    // Configurar logout
    document.getElementById('logoutBtn').addEventListener('click', function() {
        authMiddleware.logout();
    });
});

async function loadUserData() {
    try {
        const userData = await api.getCurrentUser();
        document.getElementById('userEmail').textContent = userData.email;
        
        // Atualizar UI com dados do utilizador
        authMiddleware.updateUserUI();
    } catch (error) {
        console.error('Erro ao carregar dados do utilizador:', error);
    }
}

async function loadDashboardData() {
    const userData = authMiddleware.getUserData();
    if (!userData) return;

    try {
        switch(userData.tipo) {
            case 'ADMIN':
                await loadAdminData();
                break;
            case 'MOTORISTA':
                await loadMotoristaData();
                break;
            case 'CLIENTE':
                await loadClienteData();
                break;
        }
    } catch (error) {
        console.error('Erro ao carregar dados do dashboard:', error);
    }
}

async function loadAdminData() {
    try {
        // Carregar estatísticas do admin
        const clientes = await api.getClientes();
        document.getElementById('totalClientes').textContent = clientes.length;
        
        // Aqui poderias carregar mais dados específicos do admin
    } catch (error) {
        console.error('Erro ao carregar dados do admin:', error);
    }
}

async function loadMotoristaData() {
    try {
        // Carregar dados específicos do motorista
        const viagens = await api.getViagens();
        const viagensPendentes = viagens.filter(v => v.estado === 'PENDENTE').length;
        const viagensConcluidas = viagens.filter(v => v.estado === 'CONCLUIDA').length;
        
        document.getElementById('viagensPendentes').textContent = viagensPendentes;
        document.getElementById('viagensConcluidas').textContent = viagensConcluidas;
    } catch (error) {
        console.error('Erro ao carregar dados do motorista:', error);
    }
}

async function loadClienteData() {
    try {
        // Carregar dados específicos do cliente
        const viagens = await api.getViagens();
        const viagensRealizadas = viagens.filter(v => v.estado === 'CONCLUIDA').length;
        const viagensAgendadas = viagens.filter(v => v.estado === 'AGENDADA').length;
        
        document.getElementById('viagensRealizadas').textContent = viagensRealizadas;
        document.getElementById('viagensAgendadas').textContent = viagensAgendadas;
    } catch (error) {
        console.error('Erro ao carregar dados do cliente:', error);
    }
}

function solicitarViagem() {
    alert('Funcionalidade de solicitar viagem será implementada em breve!');
}

function verPerfil() {
    alert('Funcionalidade de ver perfil será implementada em breve!');
}

function alterarPassword() {
    alert('Funcionalidade de alterar password será implementada em breve!');
}
</script>
</body>
</html> 